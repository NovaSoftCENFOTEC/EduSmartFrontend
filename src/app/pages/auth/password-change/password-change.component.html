<div class="page-wrapper d-flex flex-column min-vh-100">
  <app-topbar></app-topbar>

  <div class="flex-grow-1">
    <div class="password-change-wrapper">
      <div class="password-change-container">
        <div class="password-change-form-section">
          <div class="form-content">
            <div class="logo-container">
              <div class="logo-box">
                <img
                  src="assets/icons/EduSmartIcon.png"
                  alt="EduSmart Logo"
                  class="logo-image"
                />
              </div>
            </div>

            <h1 class="title">Cambiar Contraseña</h1>

            <p class="subtitle">Ingresa tu nueva contraseña segura</p>

            <div class="form-wrapper">
              <div class="form-container">
                <form
                  (ngSubmit)="handlePasswordChange($event)"
                  autocomplete="off"
                  #frm="ngForm"
                >
                  <div class="input-group">
                    <span class="input-group-text bg-white border-end-0">
                      <i class="bi bi-lock"></i>
                    </span>
                    <input
                      #password="ngModel"
                      [type]="showPassword ? 'text' : 'password'"
                      class="form-control border-start-0 border-end-0"
                      id="password"
                      name="password"
                      placeholder="Nueva contraseña"
                      [(ngModel)]="recoveryForm.password"
                      required
                      minlength="8"
                      style="
                        font-size: 1.1rem !important;
                        height: 50px !important;
                        padding: 0.875rem 1rem !important;
                      "
                    />
                    <button
                      type="button"
                      class="input-group-text bg-white border-start-0"
                      (click)="showPassword = !showPassword"
                      tabindex="-1"
                    >
                      <i
                        class="bi"
                        [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"
                      ></i>
                    </button>
                  </div>

                  @if (password.invalid && (password.dirty || password.touched))
                  {
                  <div class="error-message">
                    @if (password.errors?.['required']) {
                    <div>La contraseña es obligatoria.</div>
                    } @if (password.errors?.['minlength']) {
                    <div>La contraseña debe tener al menos 8 caracteres.</div>
                    }
                  </div>
                  }

                  <div class="input-group">
                    <span class="input-group-text bg-white border-end-0">
                      <i class="bi bi-shield-check"></i>
                    </span>
                    <input
                      #confirmPassword="ngModel"
                      [type]="showPassword ? 'text' : 'password'"
                      class="form-control border-start-0 border-end-0"
                      id="confirmPassword"
                      name="confirmPassword"
                      placeholder="Confirmar nueva contraseña"
                      [(ngModel)]="recoveryForm.confirmPassword"
                      required
                      style="
                        font-size: 1.1rem !important;
                        height: 50px !important;
                        padding: 0.875rem 1rem !important;
                      "
                    />
                    <button
                      type="button"
                      class="input-group-text bg-white border-start-0"
                      (click)="showPassword = !showPassword"
                      tabindex="-1"
                    >
                      <i
                        class="bi"
                        [ngClass]="showPassword ? 'bi-eye-slash' : 'bi-eye'"
                      ></i>
                    </button>
                  </div>

                  @if (confirmPassword.invalid && (confirmPassword.dirty ||
                  confirmPassword.touched)) {
                  <div class="error-message">
                    @if (confirmPassword.errors?.['required']) {
                    <div>La confirmación de contraseña es obligatoria.</div>
                    }
                  </div>
                  } @if (recoveryForm.password && recoveryForm.confirmPassword
                  && recoveryForm.password !== recoveryForm.confirmPassword) {
                  <div class="error-message">
                    <div>Las contraseñas no coinciden.</div>
                  </div>
                  }

                  <button
                    class="btn btn-primary w-100 py-2 mb-3"
                    type="submit"
                    style="
                      font-size: 1.3rem;
                      font-weight: 700;
                      height: 55px;
                      margin-top: 1rem;
                    "
                    [disabled]="
                      frm.invalid ||
                      recoveryForm.password !== recoveryForm.confirmPassword
                    "
                  >
                    <span>Cambiar Contraseña</span>
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>

        <div class="image-section">
          <div class="image-content">
            <img
              src="assets/img/PasswordChangeScreen.jpg"
              alt="EduSmart - Cambiar Contraseña"
              class="login-image"
              onError="this.style.display='none'; this.nextElementSibling.style.display='flex';"
            />

            <div class="fallback-content" style="display: none">
              <i class="fas fa-shield-alt text-indigo-500 text-6xl mb-4"></i>
              <h2 class="image-title">Seguridad</h2>
              <p class="image-subtitle">
                Protege tu cuenta con una contraseña segura
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <app-footer></app-footer>
</div>
